{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "heatmap",
  "type": "registry:ui",
  "title": "Heatmap",
  "description": "A heatmap component",
  "files": [
    {
      "path": "registry/8starlabs-ui/blocks/heatmap.tsx",
      "content": "import { cn } from \"@/lib/utils\";\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger\n} from \"@/registry/8starlabs-ui/ui/tooltip\";\nimport { HTMLAttributes, ReactNode } from \"react\";\n\nexport type HeatmapValue = {\n  date: string; // YYYY-MM-DD\n  value: number;\n};\n\nexport type HeatmapData = HeatmapValue[];\n\ntype InterpolationModes = \"linear\" | \"sqrt\" | \"log\";\n\ntype ColorOptions =\n  | {\n    colorMode: \"discrete\";\n    colorScale?: string[];\n    customColorMap?: (\n      value: number,\n      max: number,\n      colorCount: number\n    ) => number;\n  }\n  | {\n    colorMode: \"interpolate\";\n    maxColor?: string;\n    minColor?: string;\n    interpolation?: InterpolationModes;\n  };\n\ntype HeatmapProps = HTMLAttributes<HTMLDivElement> &\n  ColorOptions & {\n    data: HeatmapData;\n    startDate: Date;\n    endDate: Date;\n    cellSize?: number;\n    gap?: number;\n    daysOfTheWeek?: \"all\" | \"MWF\" | \"none\" | \"single letter\";\n    displayStyle?: \"squares\" | \"bubbles\";\n    dateDisplayFunction?: (date: Date) => ReactNode;\n    valueDisplayFunction?: (value: number) => ReactNode;\n  };\n\nfunction getAllDays(start: string, end: string): string[] {\n  // Generate all days between start and end dates (inclusive)\n  const days: string[] = [];\n  let curr = new Date(start + \"T00:00:00\");\n\n  const endDate = new Date(end + \"T00:00:00\");\n\n  while (curr <= endDate) {\n    days.push(formatLocalDate(curr));\n    curr.setDate(curr.getDate() + 1);\n  }\n\n  return days;\n}\n\nfunction padToWeekStart(days: string[]): (string | null)[] {\n  // Pad the start of the days array with nulls to align to week start (Sunday)\n  // eg. if first day is Wednesday (3), add 3 nulls at start\n  const firstDay = new Date(days[0] + \"T00:00:00\").getDay();\n  const padding = new Array(firstDay).fill(null);\n  return [...padding, ...days];\n}\n\nfunction chunkByWeek(days: (string | null)[]): (string | null)[][] {\n  // Chunk the days into weeks (arrays of 7 days)\n  const weeks: (string | null)[][] = [];\n  for (let i = 0; i < days.length; i += 7) {\n    weeks.push(days.slice(i, i + 7));\n  }\n  return weeks;\n}\n\nfunction getMonthLabel(week: (string | null)[]) {\n  // Get month label for the week (based on last non-null day)\n  const lastDay = [...week].reverse().find(Boolean);\n  return !lastDay\n    ? null\n    : new Date(lastDay + \"T00:00:00\").toLocaleString(\"default\", {\n      month: \"short\"\n    });\n}\n\nfunction defaultColourMap(value: number, max: number, colorCount: number) {\n  // Map value to color index\n  // default: we do a linear scale from 0 to max\n  if (colorCount <= 0) return 0; // safeguard\n  if (max <= 0 || value <= 0) return 0; // all zero values\n  const index = Math.ceil((value / max) * (colorCount - 1));\n  return Math.min(Math.max(index, 0), colorCount - 1);\n}\n\nfunction interpolateRgb(\n  value: number,\n  max: number,\n  minColor: string,\n  maxColor: string,\n  scale: InterpolationModes\n) {\n  if (value <= 0 || max <= 0) return minColor;\n\n  let t = value / max;\n\n  switch (scale) {\n    case \"sqrt\":\n      t = Math.sqrt(t);\n      break;\n    case \"log\":\n      t = Math.log10(value + 1) / Math.log10(max + 1);\n      break;\n  }\n\n  // Clamp t between 0 and 1\n  t = Math.min(Math.max(t, 0), 1);\n\n  const s = {\n    r: parseInt(minColor.slice(1, 3), 16),\n    g: parseInt(minColor.slice(3, 5), 16),\n    b: parseInt(minColor.slice(5, 7), 16)\n  };\n\n  const e = {\n    r: parseInt(maxColor.slice(1, 3), 16),\n    g: parseInt(maxColor.slice(3, 5), 16),\n    b: parseInt(maxColor.slice(5, 7), 16)\n  };\n\n  const r = Math.round(s.r + (e.r - s.r) * t);\n  const g = Math.round(s.g + (e.g - s.g) * t);\n  const b = Math.round(s.b + (e.b - s.b) * t);\n\n  return `rgb(${r}, ${g}, ${b})`;\n}\n\nconst defaultIntensityColours = [\n  \"#f0fdf4\", // green-50\n  \"#bbf7d0\", // green-200\n  \"#86efac\", // green-300\n  \"#22c55e\", // green-500\n  \"#166534\" // green-700\n];\n\nconst daysOfTheWeek = [\"Sun\", \"Mon\", \"Tue\", \"Wed\", \"Thu\", \"Fri\", \"Sat\"];\n\ninterface DaysOfTheWeekIndicatorProps {\n  daysOfTheWeekOption: \"all\" | \"MWF\" | \"none\" | \"single letter\";\n  fontSize: number;\n}\n\nfunction daysOfTheWeekIndicator({\n  daysOfTheWeekOption,\n  fontSize,\n}: DaysOfTheWeekIndicatorProps) {\n\n  if (daysOfTheWeekOption === \"none\") return null;\n\n  return daysOfTheWeek.map((day, i) => \n    daysOfTheWeekOption === \"MWF\" && ![1, 3, 5].includes(i)\n      ? <div \n          key={i} \n          style={{\n            gridRow: i + 2,\n            gridColumn: 1,\n          }}\n        />\n      : <div\n          key={i}\n          className=\"flex items-center text-muted-foreground\"\n          style={{ \n            gridRow: i + 2,\n            gridColumn: 1,\n            justifyContent: \"flex-end\",\n            fontSize\n          }}\n        >\n          {daysOfTheWeekOption === \"single letter\" ? day.charAt(0) : day}\n        </div>\n  );\n\n}\n\ninterface ValueIndicatorProps extends HTMLAttributes<HTMLDivElement> {\n  cellSize: number;\n  displayStyle: \"squares\" | \"bubbles\";\n  value: number; // current cell value\n  maxValue: number; // maximum possible value out of all cells\n  color: string;\n}\n\nfunction ValueIndicator({\n  cellSize,\n  displayStyle,\n  value,\n  maxValue,\n  color,\n  style,\n  ...htmlProps\n}: ValueIndicatorProps) {\n  let finalSize = cellSize;\n\n  if (displayStyle === \"bubbles\") {\n    // Min bubble size = 0.3 * size, Max bubble size = size\n    const minScale = 0.3;\n    const scale = maxValue > 0 ? value / maxValue : 0;\n    finalSize = cellSize * (minScale + (1 - minScale) * scale);\n\n    return (\n      <div\n        className=\"flex items-center justify-center\"\n        style={style}\n        {...htmlProps}\n      >\n        <span\n          className=\"transition-colors rounded-full\"\n          style={{\n            width: finalSize,\n            height: finalSize,\n            backgroundColor: color\n          }}\n        />\n      </div>\n    );\n  }\n\n  return (\n    <div\n      className=\"transition-colors rounded-md\"\n      style={{\n        borderRadius: 4,\n        backgroundColor: color,\n        ...style\n      }}\n      {...htmlProps}\n    />\n  );\n}\n\nexport default function Heatmap(props: HeatmapProps) {\n  const {\n    data,\n    startDate,\n    endDate,\n    cellSize = 20,\n    daysOfTheWeek = \"MWF\",\n    gap = 4,\n    displayStyle = \"squares\",\n    valueDisplayFunction,\n    dateDisplayFunction,\n    className,\n    colorMode,\n    ...htmlProps\n  } = props;\n\n  const valueByDate = new Map<string, number>(\n    data.map(({ date, value }) => [date, value])\n  );\n\n  const days = getAllDays(formatLocalDate(startDate), formatLocalDate(endDate));\n  const paddedDays = padToWeekStart(days);\n  const weeks = chunkByWeek(paddedDays);\n\n  const maxValue = Math.max(...data.map((d) => d.value), 0);\n\n  const monthLabels = weeks.map((week, i) => {\n    const label = getMonthLabel(week);\n    const prevLabel = i > 0 ? getMonthLabel(weeks[i - 1]) : null;\n    return label !== prevLabel ? label : null;\n  });\n\n  const fontSize = Math.min(16, cellSize);\n\n  const getCellColor = (value: number) => {\n    if (colorMode === \"interpolate\") {\n      if (value <= 0) {\n        return props.minColor ?? \"var(--heatmap-zero)\";\n      }\n\n      // value > 0\n      // interpolate between minColor and maxColor\n      return interpolateRgb(\n        value,\n        maxValue,\n        props.minColor ?? \"#aceebb\",\n        props.maxColor ?? \"#116329\",\n        props.interpolation ?? \"linear\"\n      );\n    } else {\n      const colorArray =\n        props.colorScale && props.colorScale.length > 0\n          ? props.colorScale\n          : defaultIntensityColours;\n\n      const map = props.customColorMap ?? defaultColourMap;\n\n      return colorArray[map(value, maxValue, colorArray.length)];\n    }\n  };\n\n  return (\n    <div \n      role=\"grid\"\n      className=\"grid\" \n      aria-label=\"Activity Heatmap\"\n      style={{ \n        gap,\n        gridTemplateColumns: `auto repeat(${weeks.length}, ${cellSize}px)`,\n        gridTemplateRows: `repeat(8, ${cellSize}px)`\n      }}\n      {...(htmlProps as HTMLAttributes<HTMLDivElement>)}\n    >\n\n      {daysOfTheWeekIndicator({ daysOfTheWeekOption: daysOfTheWeek, fontSize })}\n\n      {weeks.map((_, i) => (\n        <div\n          key={`header-${i}`}\n          style={{ gridColumn: i + 2, gridRow: 1, fontSize }}\n          className=\"text-muted-foreground\"\n        >\n          {monthLabels[i]}\n        </div>\n      ))}\n\n      <TooltipProvider>\n        {weeks.map((week, weekIdx) => \n          week.map((day, dayIdx) => {\n            if (!day) {\n              return (\n                <div\n                  key={dayIdx}\n                  style={{ gridColumn: weekIdx + 2, gridRow: dayIdx + 2 }}\n                />\n              );\n            }\n\n            const thisDateValue = valueByDate.get(day) ?? 0;\n            const safeValue = Math.max(0, thisDateValue);\n            const thisColor = getCellColor(safeValue);\n            const dateForDisplay = new Date(day + \"T00:00:00\");\n\n            return (\n              <Tooltip \n                key={dayIdx}\n              >\n                <TooltipTrigger asChild>\n                  <ValueIndicator\n                    style={{ gridColumn: weekIdx + 2, gridRow: dayIdx + 2 }}\n                    tabIndex={0}\n                    aria-label={`${day}: ${safeValue} event${safeValue !== 1 ? \"s\" : \"\"}`}\n                    id={`heatmap-cell-${day}`}\n                    cellSize={cellSize}\n                    displayStyle={displayStyle}\n                    value={safeValue}\n                    maxValue={maxValue}\n                    color={thisColor}\n                  />\n                </TooltipTrigger>\n                <TooltipContent>\n                  <div className=\"text-xs\">\n                    <div>\n                      {dateDisplayFunction\n                        ? dateDisplayFunction(dateForDisplay)\n                        : dateForDisplay.toDateString()}\n                    </div>\n                    <div className=\"text-muted-foreground\">\n                      {valueDisplayFunction\n                        ? valueDisplayFunction(safeValue)\n                        : `${safeValue} event${safeValue !== 1 ? \"s\" : \"\"}`}\n                    </div>\n                  </div>\n                </TooltipContent>\n              </Tooltip>\n            );\n          })\n        )}\n      </TooltipProvider>\n    </div>\n  );\n}\n\nfunction formatLocalDate(date: Date) {\n  const y = date.getFullYear();\n  const m = String(date.getMonth() + 1).padStart(2, \"0\");\n  const d = String(date.getDate()).padStart(2, \"0\");\n  return `${y}-${m}-${d}`;\n}",
      "type": "registry:ui"
    }
  ]
}
